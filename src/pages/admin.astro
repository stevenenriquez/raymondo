---
import SiteLayout from '@components/SiteLayout.astro';

const currentYear = new Date().getFullYear();
const yearOptions = Array.from({ length: currentYear - 1989 }, (_, index) => currentYear - index);
---

<SiteLayout title="Raymondo Admin" description="Admin dashboard for Raymondo portfolio content.">
  <main class="admin-shell admin-editor-shell admin-v2-shell">
    <header class="site-header">
      <h1 class="brand">Raymondo Admin</h1>
      <nav class="site-nav">
        <a href="/">View Site</a>
        <a href="mailto:hello@raymondo.design">Support</a>
      </nav>
    </header>

    <p class="notice" style="margin-top:0.8rem;">
      Manage posts here.
    </p>

    <div class="admin-workspace admin-v2-workspace">
      <aside class="admin-panel admin-projects-panel admin-v2-projects">
        <h2>Projects</h2>

        <div class="admin-actions" style="margin-bottom:0.8rem;">
          <button type="button" id="newGraphicBtn">New Graphic</button>
          <button type="button" id="new3dBtn" class="btn secondary">New 3D</button>
        </div>

        <label class="admin-v2-search-label">
          Search
          <input id="projectSearch" type="search" placeholder="Search title or slug" />
        </label>

        <div class="admin-v2-filter-row" id="projectFilterBar" role="group" aria-label="Project filters">
          <button type="button" class="filter-chip" data-filter="all" aria-pressed="true">All</button>
          <button type="button" class="filter-chip" data-filter="draft" aria-pressed="false">Draft</button>
          <button type="button" class="filter-chip" data-filter="ready" aria-pressed="false">Ready</button>
          <button type="button" class="filter-chip" data-filter="blocked" aria-pressed="false">Blocked</button>
          <button type="button" class="filter-chip" data-filter="published" aria-pressed="false">Published</button>
        </div>

        <ul class="project-list admin-v2-project-list" id="projectList"></ul>
      </aside>

      <section class="admin-editor-region admin-v2-editor">
        <div id="feedback"></div>

        <form class="admin-inline-form" id="projectForm" novalidate>
          <section class="admin-panel admin-v2-toolbar" id="adminTopBar">
            <div class="admin-v2-toolbar-meta">
              <p class="admin-v2-project-label" id="activeProjectLabel">No project selected</p>
              <div class="admin-v2-toolbar-badges">
                <span id="projectStatusBadge" class="status-pill draft">draft</span>
                <span id="saveStateChip" class="admin-v2-save-chip saved">Saved</span>
              </div>
            </div>
            <div class="admin-actions">
              <button type="button" class="btn secondary" id="saveNowBtn">Save Now</button>
              <button type="button" class="btn secondary" id="previewBtn">Preview</button>
              <button type="button" id="publishBtn">Publish Snapshot</button>
              <button type="button" class="btn ghost" id="unpublishBtn">Unpublish</button>
              <button type="button" class="btn danger" id="deleteBtn">Delete Draft</button>
            </div>
          </section>

          <section class="admin-panel">
            <h2>Content</h2>
            <p class="notice">Core fields for drafting and publish readiness.</p>

            <div class="form-grid" style="margin-top:0.8rem;">
              <label class="admin-v2-project-id">Project ID
                <input class="admin-v2-project-id-input" type="text" name="id" readonly />
              </label>
              <label>Slug
                <input type="text" name="slug" placeholder="moro-studio-identity" />
              </label>
                <label>Discipline
                <select name="discipline" class="admin-v2-select-input">
                  <option value="graphic">Graphic</option>
                  <option value="3d">3D</option>
                </select>
              </label>
              <label>Style Template
                <select name="styleTemplate" class="admin-v2-select-input">
                  <option value="editorial">Editorial</option>
                  <option value="brutalist">Brutalist</option>
                  <option value="minimal-grid">Minimal Grid</option>
                </select>
              </label>
            </div>

            <label style="margin-top:0.8rem;">Project Title
              <input class="inline-input" type="text" name="title" placeholder="Project title" />
            </label>

            <label style="margin-top:0.6rem;">Short Description
              <textarea class="inline-textarea" name="descriptionShort" placeholder="One-line summary for cards and SEO"></textarea>
            </label>

            <label style="margin-top:0.6rem;">Long Description
              <textarea class="inline-textarea" name="descriptionLong" placeholder="Project narrative for the public page"></textarea>
            </label>

            <details class="admin-v2-advanced" open>
              <summary>Advanced: Taxonomy</summary>
              <div class="form-grid">
                <label>Year
                  <select name="year" class="admin-v2-select-input">
                    {yearOptions.map((year) => (
                      <option value={year} selected={year === currentYear}>{year}</option>
                    ))}
                  </select>
                </label>
                <label>Tags (comma-separated)
                  <input type="text" name="tags" placeholder="Branding,Editorial,3D" />
                </label>
                <label>Palette (comma-separated)
                  <input type="text" name="palette" placeholder="#111111,#d65c3b,#f5f0e5" />
                </label>
              </div>
              <div class="palette" id="palettePreview" style="margin-top:0.55rem;"></div>
            </details>

            <details class="admin-v2-advanced">
              <summary>Advanced: Story and Process Notes</summary>
              <div class="form-grid admin-v2-notes-grid">
                <label>Inspiration and Theme
                  <textarea class="inline-textarea" name="themeInspiration" placeholder="Theme inspiration notes"></textarea>
                </label>
                <label>Design DNA
                  <textarea class="inline-textarea" name="styleDirection" placeholder="Visual direction, references, and tone"></textarea>
                </label>
                <label>Typography Notes
                  <textarea class="inline-textarea" name="typographyNotes" placeholder="Type choices and rationale"></textarea>
                </label>
                <label>Motif Summary
                  <textarea class="inline-textarea" name="motifSummary" placeholder="Key motifs and recurring visual elements"></textarea>
                </label>
                <label class="three-d-only">Tooling Notes
                  <textarea class="inline-textarea" name="toolingNotes" placeholder="3D tools, workflow, render pipeline"></textarea>
                </label>
                <label class="three-d-only">Material Notes
                  <textarea class="inline-textarea" name="materialNotes" placeholder="Materials, textures, and lighting notes"></textarea>
                </label>
              </div>
            </details>
          </section>

          <section class="admin-assets-section admin-v2-assets" id="assetsSection">
            <h2 class="admin-subheading">Assets</h2>
            <p class="notice">Drop files to auto-attach with smart defaults. First usable visual becomes the cover if missing.</p>

            <div id="dropzone" class="dropzone" style="margin-top:0.8rem;">
              Drag and drop files here or
              <label style="display:inline;cursor:pointer;text-decoration:underline;">
                browse
                <input id="fileInput" type="file" multiple style="display:none;" />
              </label>
            </div>

            <p class="notice" id="uploadStatus" style="margin-top:0.6rem;"></p>

            <h3 class="admin-v2-asset-title">Manage Uploaded Assets</h3>
            <div id="assetList" class="asset-editor-grid admin-v2-asset-list"></div>
          </section>

          <section class="admin-panel admin-v2-publish" id="publishPanel">
            <h2>Publish</h2>
            <p class="notice">Checklist below uses current server-side readiness rules.</p>

            <div class="admin-v2-readiness-grid">
              <article class="admin-v2-readiness-card" id="contentSection">
                <h3>Hard Requirements</h3>
                <ul id="hardMissingList" class="admin-v2-checklist"></ul>
              </article>
              <article class="admin-v2-readiness-card">
                <h3>Quality Warnings</h3>
                <ul id="softMissingList" class="admin-v2-checklist"></ul>
              </article>
            </div>

            <p id="preflightSummary" class="notice" style="margin-top:0.5rem;"></p>
          </section>
        </form>

        <div class="admin-v2-mobile-bar">
          <button type="button" class="btn secondary" id="mobileSaveBtn">Save</button>
          <button type="button" class="btn secondary" id="mobilePreviewBtn">Preview</button>
          <button type="button" id="mobilePublishBtn">Publish</button>
          <button type="button" class="btn ghost" id="mobileAssetsBtn">Add Assets</button>
        </div>
      </section>
    </div>
  </main>

  <dialog id="preflightDialog" class="admin-v2-dialog">
    <article class="admin-v2-dialog-card">
      <h2>Publish Preflight</h2>
      <p class="notice" id="preflightDialogIntro">Checking requirements...</p>

      <div class="admin-v2-readiness-grid">
        <article class="admin-v2-readiness-card">
          <h3>Current Project Blockers</h3>
          <ul id="modalHardList" class="admin-v2-checklist"></ul>
        </article>
        <article class="admin-v2-readiness-card">
          <h3>Published Project Blockers</h3>
          <ul id="modalGlobalList" class="admin-v2-checklist"></ul>
        </article>
      </div>

      <div class="admin-actions" style="margin-top:1rem;justify-content:flex-end;">
        <button type="button" class="btn secondary" id="preflightCancelBtn">Cancel</button>
        <button type="button" id="preflightConfirmBtn">Publish Now</button>
      </div>
    </article>
  </dialog>

  <dialog id="previewDialog" class="admin-v2-dialog">
    <article class="admin-v2-dialog-card admin-v2-preview-dialog-card">
      <h2>Draft Preview</h2>
      <p class="notice" id="previewDialogIntro">Previewing current editor values.</p>

      <div id="previewDialogContent" class="admin-v2-preview-content"></div>

      <div class="admin-actions" style="margin-top:1rem;justify-content:flex-end;">
        <button type="button" class="btn secondary" id="previewCloseBtn">Close</button>
        <a id="previewOpenRouteBtn" class="btn ghost" href="#" target="_blank" rel="noopener noreferrer">Open Public Route</a>
      </div>
    </article>
  </dialog>

  <script is:inline type="module" src="/admin.js"></script>
  <script
    is:inline
    type="module"
    src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"
  ></script>
</SiteLayout>
